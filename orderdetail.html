<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>KantinVirtual - Tugas Kelompok ADPRO A8</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet"/>
    <meta name="google-signin-client_id"
        content="958450163552-tgnfgdqteu4qa26d2hhr8vskik1j9raq.apps.googleusercontent.com">

    <!-- Tailwind -->
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <style>
        #glassM {
            background: rgba(255, 255, 255, 0.50);
            box-shadow: 0 4px 20px -7px rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(7.0px);
            -webkit-backdrop-filter: blur(7.0px);
            /* border-radius: 10px; */
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        /* #databuyer{
            border: 2px solid black;
        } */
        h3 strong{
            border: 1px blue;
        }
    </style>
</head>

<body>
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg fixed-top" id="glassM">
        <div class="container">
            <a class="navbar-brand text-purple-500 font-bold tracking-widest flex items-center justify-center space-x-3 hover:text-purple-500"
                href="#!">
                <img src="/assets/logo.svg" alt="kantin virtual logo" style="height: 20px;">
                <p>KantinVirtual</p>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><img
                    src="/assets/hamburger.svg" alt=""></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link hover:text-purple-500" href="index.html">
                            Home
                        </a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link hover:text-purple-500" href="product.html">
                            Product
                        </a>
                    </li>
                    <li class="nav-item active" id="orderbtn"><a class="nav-link hover:text-purple-500"
                        href="order_list.html">Orders</a></li>
                    <li class="nav-item active" id="checkoutbtn"><a class="nav-link hover:text-purple-500"
                        href="createorder.html">Checkout</a></li>
                    <li class="nav-item text-purple-500" id="profilebtn"><a class="nav-link"
                            href="profile.html">Profile</a></li>
                    <li class="nav-item text-purple-500" id="signupbtn"><a class="nav-link hover:text-purple-500"
                            href="signup.html">Sign
                            Up</a></li>
                    <li class="nav-item text-purple-500" id="loginbtn"><a class="nav-link hover:text-purple-500"
                            href="login.html">Login</a>
                    </li>
                    <li class="nav-item text-purple-500" id="logoutbtn"><a class="nav-link hover:text-purple-500"
                            href="#">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="mb-8">
        <div class="container mx-auto mt-24">
            <a className="mt-8 text-purple-500 hover:text-purple-500 text-lg" href="order_list.html">&#60; Kembali</a>
            <div class="flex flex-col md:flex-row space-y-6 md:space-y-0 items-center md:items-start justify-between">
                <div class="flex flex-col items-center md:items-start">
                    <h1 class="mb-2 text-3xl sm:text-4xl">Order Details</h1>
                    <div class="w-5/6 bg-purple-500 px-3 h-1 rounded-xl" />
                </div>
            </div>
        </div>
        <div id="alamatkosong" class="mt-4 mx-4">
            <p class="lg:text-xl font-bold md:text-base">Tidak bisa mengubah status order</p>
            <p class="lg:text-base md:text-sm">Pembeli harus mengatur alamat tujuan pada bagian profile</p>
        </div>
        <div id="#orderdata" class="container w-full flex flex-col mt-12 mx-auto space-y-4 min-h-0 sm:h-auto md:min-h-full rounded-2xl border-2 border-purple-500 p-7 sm:p-12">
            <div id="databuyer" class="w-full">
                <h3 class="text-xl sm:text-md font-bold">Pram</h3>
                <p class="text-md sm:text-sm">Jln Kangkung no.20, Kebayoran Lama, Jakarta Selatan</p>
            </div>
            <div id="dataseller" class="w-full flex flex-row space-x-4" >
                <div class="flex-grow""><h3 class="text-xl font-bold">Umji</h3></div>
                <div><h3 class="text-lg font-bold">#0001</h3></div>
            </div>
            <div id="datapesanan">
                <p>Items:</p>
                <span class="flex flex-row md:text-base sm:text-sm">
                    <p class="flex-grow">Sate ayam x2</p>
                    <p class="font-semibold">Rp 20000</p>
                </span>
                <span class="flex flex-row md:text-base sm:text-sm">
                    <p class="flex-grow">Ramyeon x4</p>
                    <p><strong>Rp 60000</strong></p>
                </span>
                <span class="flex flex-row md:text-base sm:text-sm">
                    <p class="flex-grow">Bakso malang x1</p>
                    <p><strong>Rp 10000</strong></p>
                </span>
                <span class="flex flex-row md:text-base sm:text-sm">
                    <p class="flex-grow">Bibimbap x1</p>
                    <p><strong>Rp 12000</strong></p>
                </span>
            </div>
            <div id="totalharga" class="text-md text-right"><p class="font-bold">Total: Rp 102000</p></div>
            <div class="w-full mt-4 bg-gray-400 px-2 h-1 rounded-xl" />
            <div class="h-12">
                <button id="statebtn" class="px-6 py-2 my-2 text-center bg-purple-500 rounded-xl text-white hover:no-underline hover:shadow-lg w-full sm:w-auto md:w-auto text-center" type="submit">Open Order</button>
            </div>
        </div>
    </main>
    <!-- Bootstrap core JS-->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/lib/jwt-decode.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/order.js"></script>

    <!-- Core theme JS-->
    <script>
        (function () {
            loadLoginData()
            const userData = JSON.parse(localStorage.getItem("tokenData"))
            let userRole = userData.type
            console.log(userRole)
            const order_id = localStorage.getItem("order_id")
            let orderData = ""
            let items = []
            let alamat = ""
            if (getLoggedInStatus()) {
                $('#signupbtn').hide();
                $('#loginbtn').hide();
                getOrderById(order_id).then((response) => orderData).catch((reason) => alert(reason))
                console.log(orderData)
                items = orderData.items
                if (orderData.buyer.alamat === "" || orderData.buyer.alamat === null){
                    $('#orderdata').hide()
                    $('#alamatkosong').show()
                }
                else{
                    $('#alamatkosong').hide()
                    $('#orderdata').show()
                    $('#databuyer').append(`
                        <h3 class="text-xl sm:text-md font-bold">`+ orderData.buyer.name +`</h3>
                        <p class="text-md sm:text-sm">`+ orderData.buyer.alamat +`</p>
                    `)
                    $('#dataseller').append(`
                        <div class="flex-grow""><h3 class="text-xl font-bold">`+ orderData.seller.name +`</h3></div>
                        <div><h3 id="orderid" class="text-lg font-bold">#`+ orderData.id +`</h3></div>
                    `)
                    items.forEach(item => {
                        $('#datapesanan').append(`
                        span class="flex flex-row md:text-base sm:text-sm">
                            <p class="flex-grow">`+ item.name +` x`+ item.quantity +`</p>
                            <p class="font-semibold">Rp `+ item.price +`</p>
                        </span>
                        `) 
                    });
                    $('#totalharga').append('<p class="font-bold">Total: Rp '+ orderData.totalPrice +'</p>')
                }

                if (userRole === "buyer"){
                    switch (orderData.status) {
                        case "Open":
                            $('#statebtn').replaceWith(`
                                <button onclick="() => {
                                    confirmOrder($('#orderid').val())
                                    location.reload()
                                }" id="statebtn" class="px-6 py-2 my-2 text-center bg-purple-500 rounded-xl text-white hover:no-underline hover:shadow-lg w-full sm:w-auto md:w-auto text-center" type="submit">Pay Order</button>
                            `)
                            break;
                        case "Confirmed":
                            $('#statebtn').replaceWith(`
                                <button disabled id="statebtn" class="px-6 py-2 my-2 text-center bg-gray-500 rounded-xl text-white hover:no-underline hover:shadow-lg w-full sm:w-auto md:w-auto text-center" type="submit">Waiting for seller to ship order</button>
                            `)
                            break;
                        case "Ship":
                            $('#statebtn').replaceWith(`
                                <button onclick="() => {
                                    deliverOrder($('#orderid').val())
                                    location.reload()
                                }" id="statebtn" class="px-6 py-2 my-2 text-center bg-purple-500 rounded-xl text-white hover:no-underline hover:shadow-lg w-full sm:w-auto md:w-auto text-center" type="submit">Order has arrived</button>
                            `)
                            break;
                        case "Delivered":
                            $('#statebtn').replaceWith(`
                                <button disabled id="statebtn" class="px-6 py-2 my-2 text-center bg-gray-500 rounded-xl text-white hover:no-underline hover:shadow-lg w-full sm:w-auto md:w-auto text-center" type="submit">Order Complete</button>
                            `)
                            break;
                    }
                } else if (userRole === "seller"){
                    switch (orderData.status) {
                        case "Open":
                            $('#statebtn').replaceWith(`
                                <button disabled id="statebtn" class="px-6 py-2 my-2 text-center bg-gray-500 rounded-xl text-white hover:no-underline hover:shadow-lg w-full sm:w-auto md:w-auto text-center" type="submit">Waiting for payment</button>
                            `)
                            break;
                        case "Confirmed":
                            $('#statebtn').replaceWith(`
                                <button onclick="() => {
                                    shipOrder($('#orderid').val())
                                    location.reload()
                                }" id="statebtn" class="px-6 py-2 my-2 text-center bg-purple-500 rounded-xl text-white hover:no-underline hover:shadow-lg w-full sm:w-auto md:w-auto text-center" type="submit">Ship Order</button>
                            `)
                            break;
                        case "Ship":
                            $('#statebtn').replaceWith(`
                                <button disabled id="statebtn" class="px-6 py-2 my-2 text-center bg-gray-500 rounded-xl text-white hover:no-underline hover:shadow-lg w-full sm:w-auto md:w-auto text-center" type="submit">Order has been shipped</button>
                            `)
                            break;
                        case "Delivered":
                            $('#statebtn').replaceWith(`
                                <button disabled id="statebtn" class="px-6 py-2 my-2 text-center bg-gray-500 rounded-xl text-white hover:no-underline hover:shadow-lg w-full sm:w-auto md:w-auto text-center" type="submit">Order Complete</button>
                            `)
                            break;
                    }
                }

            } else {
                $('#logoutbtn').hide();
                $('#profilebtn').hide();
                $('#orderbtn').hide();
                $('#checkoutbtn').hide();
                location.href = 'index.html';
            }

            $('#logoutbtn').on("click", function (e) {
                logout();
            })
        })()
    </script>
</body>
</html>